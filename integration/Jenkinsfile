pipeline {
  agent {
    label 'scc-happy-customer'
  }

  stages {
    stage('checkout') {
      steps {
        script {
          currentBuild.displayName = "#${BUILD_NUMBER}: ${branch}"
        }

        git url: 'git@github.com:SUSE/rmt.git', branch: "${branch}"
      }
    }
    stage('copy configuration') {
      steps {
        sh 'cp /home/jenkins/options-local-connect-prophet.yml integration/prophet/options-local.yml'
      }
    }
    stage('run prophet') {
      steps {
        sh 'gem.ruby2.5 install --user-install octokit -v 4.21.0'
        sh 'gem.ruby2.5 install --user-install prophet'
        sh 'ruby.ruby2.5 ./integration/prophet/prophet.rb'
      }
    }
  }
}
